sap.ui.define(["sap/ui/core/mvc/Controller","pw/productionwarehouse/controller/BaseController","sap/ui/core/Fragment","sap/ui/model/Filter","sap/m/MessageToast"],(e,t,o,a,i)=>{"use strict";return t.extend("pw.productionwarehouse.controller.ProductionWarehouseDetails",{onInit(){this.getRouter().getRoute("RouteProductionWarehouseDetails").attachPatternMatched(this._onRouterProductionWarehouseDetailsMatched,this)},_onRouterProductionWarehouseDetailsMatched:function(e){this.byId("idItemsVBox").destroyItems();let t=e.getParameter("arguments");let o=this.getOwnerComponent().getModel("DetailsModel").getProperty("/Complaint/status");this._oID=t.ID;if(this._oID!="NEW"&&o!="DRAFT"){this.getOwnerComponent().getModel("DetailsModel").setProperty("/editable",false)}else{this.getOwnerComponent().getModel("DetailsModel").setProperty("/editable",true)}let a=this.getOwnerComponent().getModel("DetailsModel").getProperty("/Complaint/items");if(this._oID!="NEW"&&a.length>0){this._buildItemDetailsForms(a)}console.log(this._oID)},_buildItemDetailsForms:function(e){let t=this.byId("idItemsVBox");e.forEach(e=>{let o=new sap.ui.layout.form.SimpleForm({layout:"ColumnLayout",columnsM:2,editable:true,toolbar:new sap.m.Toolbar({content:[new sap.m.Title({text:e.product_ID,level:"H3"}),new sap.m.ToolbarSpacer,new sap.m.Button({icon:"sap-icon://delete",type:"Reject",enabled:"{DetailsModel>/editable}",press:function(e){try{let t=e.getSource().getParent().getParent().getParent();t.destroy();i.show("Form closed successfully")}catch(e){i.show("Form not closed")}}.bind(this)})]}),content:[new sap.m.Label({text:"product_ID",required:true,visible:false}),new sap.m.Input({value:e.product_ID,visible:false}),new sap.m.Label({text:"Supplier",required:true}),new sap.m.Input({value:e.supplier,editable:"{DetailsModel>/editable}"}),new sap.m.Label({text:"Batch No",required:true}),new sap.m.Input({value:e.batchNo,editable:"{DetailsModel>/editable}"}),new sap.m.Label({text:"Production",required:true}),new sap.m.DatePicker({value:e.productionDate,displayFormat:"dd/MM/y",valueFormat:"yyyy-MM-dd",editable:"{DetailsModel>/editable}"}),new sap.m.Label({text:"Expiration",required:true}),new sap.m.DatePicker({value:e.expirationDate,displayFormat:"dd/MM/y",valueFormat:"yyyy-MM-dd",editable:"{DetailsModel>/editable}"}),new sap.m.Label({text:"lot code",required:true}),new sap.m.Input({value:e.lotCode,editable:"{DetailsModel>/editable}"}),new sap.m.Label({text:"Received On",required:true}),new sap.m.DatePicker({value:e.receivedOn,displayFormat:"dd/MM/y",valueFormat:"yyyy-MM-dd",editable:"{DetailsModel>/editable}"}),new sap.m.Label({text:"Qty",required:true}),new sap.m.Input({value:e.quantity,editable:"{DetailsModel>/editable}"}),new sap.m.Label({text:"Invoice Number",required:true}),new sap.m.Input({value:e.invoiceNumber,editable:"{DetailsModel>/editable}"})]});t.addItem(o)})},onDeclineBtnPress:function(){this.getRouter().navTo("RouteProductionWarehouseComplaints")},onAddItemBtnPress:function(e){if(!this._ItemsDialog){this._ItemsDialog=this.loadFragment("pw.productionwarehouse.view.fragments.ItemsDialog")}this._ItemsDialog.then(function(e){e.open()})},onCancelDialogPress:function(){this._ItemsDialog.then(function(e){e.close()})},onItemsSearch:function(e){let t=e.getSource().getValue();let o=[];if(t&&t.length>0){let e=new a("supplier","Contains",t);o.push(e)}let i=this.byId("idItemsList");let s=i.getBinding("items");s.filter(o)},onItemSelection:function(e){let t=e.getSource().getBindingContext().getObject();let o=t.ID;let a=this.byId("idItemsVBox");let s=new sap.ui.layout.form.SimpleForm({layout:"ColumnLayout",columnsM:2,editable:true,toolbar:new sap.m.Toolbar({content:[new sap.m.Title({text:t.productName,level:"H3"}),new sap.m.ToolbarSpacer,new sap.m.Button({icon:"sap-icon://delete",type:"Reject",press:function(e){try{let t=e.getSource().getParent().getParent().getParent();t.destroy();i.show("Form closed successfully")}catch(e){i.show("Form not closed")}}.bind(this)})]}),content:[new sap.m.Label({text:"product_ID",required:true,visible:false}),new sap.m.Input({value:o,visible:false}),new sap.m.Label({text:"Supplier",required:true}),new sap.m.Input,new sap.m.Label({text:"Batch No",required:true}),new sap.m.Input,new sap.m.Label({text:"Production",required:true}),new sap.m.DatePicker({dateValue:new Date,displayFormat:"dd/MM/y",valueFormat:"yyyy-MM-dd"}),new sap.m.Label({text:"Expiration",required:true}),new sap.m.DatePicker({dateValue:new Date,displayFormat:"dd/MM/y",valueFormat:"yyyy-MM-dd"}),new sap.m.Label({text:"lot code",required:true}),new sap.m.Input,new sap.m.Label({text:"Received On",required:true}),new sap.m.DatePicker({dateValue:new Date,displayFormat:"dd/MM/y",valueFormat:"yyyy-MM-dd"}),new sap.m.Label({text:"Qty",required:true}),new sap.m.Input,new sap.m.Label({text:"Invoice Number",required:true}),new sap.m.Input]});a.addItem(s);this.onCancelDialogPress()},onUploadBtnPress:function(){if(!this._UploadDialog){this._UploadDialog=this.loadFragment("pw.productionwarehouse.view.fragments.UploadDialog")}this._UploadDialog.then(function(e){e.open()})},onFileUploadPress:function(){let e=this.byId("idFileUploader");let t=e.getProperty("value");if(t){let e={fileName:t,uploadedBy:"hemanth",uploadedAt:new Date};this.getOwnerComponent().getModel("DetailsModel").getProperty("/Complaint/attachments").push(e);this.onCloseUploadDialogPress();this.byId("idAttachmentsTable").getBinding("items").refresh()}else{this.getWarningMessageBox("File is not selected.Please select.");e.setValueState("Warning");e.setValueStateText("No file selected")}},onFileChange:function(){let e=this.byId("idFileUploader");e.setValueState("None")},onCloseUploadDialogPress:function(){this.byId("idFileUploader").clear();this._UploadDialog.then(function(e){e.close()})},_getItemFormDetails:function(){let e=this.byId("idItemsVBox").getItems();console.log(e);if(e.length>0){let t=e.map(e=>{let t=e._aElements;let o={};for(let e=0;e<t.length;e+=2){let a=t[e].getText();let i=t[e+1].getValue();switch(a){case"product_ID":o["product_ID"]=i;break;case"Supplier":o["supplier"]=i;break;case"Batch No":o["batchNo"]=i;break;case"Production":o["productionDate"]=i;break;case"Expiration":o["expirationDate"]=i;break;case"lot code":o["lotCode"]=i;break;case"Received On":o["receivedOn"]=i;break;case"Qty":o["quantity"]=i;break;case"Invoice Number":o["invoiceNumber"]=i;break}}return o});this.getOwnerComponent().getModel("DetailsModel").setProperty("/Complaint/items",t);console.log(t)}},onSubmitBtnPress:function(){this._getItemFormDetails();console.log(this.getOwnerComponent().getModel("DetailsModel").getProperty("/Complaint"));let e=this.getOwnerComponent().getModel("DetailsModel").getProperty("/Complaint");e["status"]="MANAGER_APPROVAL_PENDING";if(this._oID==="NEW"){this.ODataPost("/Complaints",e)}else{$.ajax({url:this.getBaseURL()+"/odata/v4/production-warehouse/Complaints('"+this._oID+"')",method:"PUT",contentType:"application/json",data:JSON.stringify(e),success:function(e){i.show("Successfully Updated")},error:function(e){i.show("Error submitting data")}})}this.onDeclineBtnPress()},onCompleteLaterBtnPress:function(){this._getItemFormDetails();console.log(this.getOwnerComponent().getModel("DetailsModel").getProperty("/Complaint"));let e=this.getOwnerComponent().getModel("DetailsModel").getProperty("/Complaint");e["status"]="DRAFT";if(this._oID==="NEW"){this.ODataPost("/Complaints",e)}else{$.ajax({url:this.getBaseURL()+"/odata/v4/production-warehouse/Complaints('"+this._oID+"')",method:"PUT",contentType:"application/json",data:JSON.stringify(e),success:function(e){i.show("Successfully Updated")},error:function(e){i.show("Error submitting data")}})}this.onDeclineBtnPress()}})});
//# sourceMappingURL=ProductionWarehouseDetails.controller.js.map